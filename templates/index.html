<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JSON 自動修正ツール</title>
    <style>
        /* ボタンのスタイルを少し整える (任意) */
        #copy-button {
            margin-bottom: 10px;
        }
        pre {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 10px;
            white-space: pre-wrap; /* JSONが長い場合でも折り返す */
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>JSON 自動修正ツール</h1>

    <form method="post">
        <textarea name="input_text" rows="15" cols="80"
                  placeholder="ここにJSONを貼り付けてください"></textarea><br>

        <button type="submit">修正して出力</button>
    </form>

    {% if result %}
    <h2>結果</h2>

    <button id="copy-button" onclick="copyToClipboard()">結果をコピー</button>

    <pre id="json-result">{{ result }}</pre>

    <script>
        function copyToClipboard() {
            // 1. <pre> タグのテキスト内容を取得
            var resultText = document.getElementById("json-result").innerText;
            
            // 2. クリップボードAPIを使用してテキストをコピー
            navigator.clipboard.writeText(resultText).then(function() {
                // 3. 成功時のフィードバック
                var copyButton = document.getElementById("copy-button");
                var originalText = copyButton.innerText;
                copyButton.innerText = "コピーしました！";
                
                // 2秒後にボタンのテキストを元に戻す
                setTimeout(function() {
                    copyButton.innerText = originalText;
                }, 2000);
            }, function(err) {
                // 4. 失敗時のエラーハンドリング
                console.error('クリップボードへのコピーに失敗しました: ', err);
                alert("コピーに失敗しました。");
            });
        }
    </script>
    {% endif %}
</body>
</html>